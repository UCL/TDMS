<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TDMS: TDMS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TDMS
   </div>
   <div id="projectbrief">Time Domain Maxwell Solver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TDMS </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a>   </p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
TDMS Â· <a href="https://github.com/UCL/TDMS/releases"><img src="https://badgen.net/github/release/UCL/TDMS" alt="latest release" class="inline"/></a> <a href="https://github.com/UCL/TDMS/blob/main/LICENSE"><img src="https://badgen.net/badge/license/GPL-3.0/blue" alt="license" class="inline"/></a> <a href="https://github.com/UCL/TDMS/actions/workflows/ci.yml"><img src="https://github.com/UCL/TDMS/actions/workflows/ci.yml/badge.svg" alt="Build and test" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/UCL/TDMS/actions/workflows/matlab_tests.yml"><img src="https://github.com/UCL/TDMS/actions/workflows/matlab_tests.yml/badge.svg" alt="MATLAB tests" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/UCL/TDMS"><img src="https://codecov.io/gh/UCL/TDMS/branch/main/graph/badge.svg?token=3kqP14kslL" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://zenodo.org/badge/latestdoi/448864310"><img src="doc/assets/doi-badge.svg" alt="DOI:10.5281/zenodo.7950603" style="pointer-events: none;" class="inline"/></a></h1>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Time-Domain Maxwell Solver</h1>
<p>TDMS, the Time Domain Maxwell Solver, is a hybrid C++ and MATLAB tool for simulating light propagation through a medium by solving Maxwell's equations. For further details about the method, please refer to the <a href="https://github.com/UCL/TDMS/blob/gh-doc/masterdoc.pdf">PDF documentation</a>.</p>
<p><img src="doc/assets/HzNormBanner.png" alt="The normed z-component of the H field incident on a cylinder" class="inline"/></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Getting started</h2>
<p>We don't ship binaries at the moment, so to use TDMS, it has to be compiled. It needs to be built against <a href="https://www.fftw.org/">FFTW</a> and <a href="https://www.mathworks.com/products/matlab.html">MATLAB</a>, which must be downloaded and installed first.</p>
<details >
<summary >
<img src="https://github.com/EgoistDeveloper/operating-system-logos/blob/master/src/24x24/UBT.png" alt="" class="inline"/> Linux prerequisite setup</summary>
<p></p>
<p>Assuming you don't already have them, you'll need a C++ compiler, CMake, OpenMP and FFTW.</p>
<p>For Debian-based distributions this should be as simple as</p>
<div class="fragment"><div class="line">$ sudo apt install git gcc cmake libfftw3-dev libgomp1</div>
</div><!-- fragment --><p></p>
</details>
<details >
<summary >
<img src="https://github.com/EgoistDeveloper/operating-system-logos/blob/master/src/24x24/MAC.png" alt="" class="inline"/> MacOS prerequisite setup</summary>
<p></p>
<p>On MacOS everything can be installed using <a href="https://brew.sh">Homebrew</a>:</p>
<div class="fragment"><div class="line">$ brew install cmake fftw llvm hdf5</div>
</div><!-- fragment --><p></p>
</details>
<details >
<summary >
<img src="https://github.com/EgoistDeveloper/operating-system-logos/blob/master/src/24x24/WIN.png" alt="" class="inline"/> Windows prerequisite setup</summary>
<p></p>
<p>TDMS was developed - and extensively tested - on linux. Support for Windows is quite new and experimental (please <a href="https://github.com/UCL/TDMS/issues/new/choose">report</a> any issues you encounter!).</p>
<p>It might be more straightforward to use the <a href="https://learn.microsoft.com/en-gb/windows/wsl/install">Windows subsystem for Linux (WSL2)</a>, or set up an linux virtual machine.</p>
<p>However, TDMS <em>can</em> be compiled natively on Windows. This has been tested Windows 10 and 11, with PowerShell.</p>
<p>Assuming you don't already have them, you'll need to download and install:</p>
<p></p>
<ul>
<li><a href="https://www.mathworks.com/products/matlab.html">MATLAB</a>,</li>
<li><a href="https://visualstudio.microsoft.com/vs/community/">Visual Studio</a> and <b>be sure to select the C++ developer kit</b>,</li>
<li><a href="https://cmake.org/download/">CMake</a>,</li>
<li>and <a href="https://www.fftw.org/install/windows.html">FFTW</a>.</li>
</ul>
<p>You can check that the Visual Studio compiler was installed with:</p>
<div class="fragment"><div class="line">PS&gt; MSBuild.exe -h</div>
</div><!-- fragment --><p>Potentially the simplest way to get FFTW is via <a href="https://anaconda.org/conda-forge/fftw">conda</a>:</p>
<div class="fragment"><div class="line">PS&gt; conda install -c conda-forge fftw --yes</div>
</div><!-- fragment --><p>You'll need to ensure the paths to FFTW and MATLAB (the locations of <span class="tt">fftw3.dll</span> and <span class="tt">libmex.dll</span> respectively) are in the <span class="tt">env:Path</span>.</p>
<p>These can be found, e.g. by</p>
<div class="fragment"><div class="line">PS&gt; conda list fftw # assuming you installed via conda</div>
<div class="line">PS&gt; which.exe MATLAB</div>
</div><!-- fragment --><p>Which should return something like <span class="tt">C:\Program Files (x86)\MATLAB\R20XXx\bin\matlab</span> and maybe <span class="tt">C:\ProgramData\envs\base\bin</span>. If you downloaded FFTW and created <span class="tt">fftw3.dll</span> with <span class="tt">lib.exe</span>, you just need to know where you saved it.</p>
<p>You can append the paths:</p>
<div class="fragment"><div class="line">PS&gt; $env:Path += &quot;;C:\Program Files (x86)\MATLAB\R20XXx\bin\;C:\ &lt; wherever fftw3.dll is &gt;&quot;</div>
</div><!-- fragment --><p>Which will help Windows locate <span class="tt">.dll</span> files later. For all following instructions, you'll have to substitute our mentions of <span class="tt">tdms</span> with <span class="tt">tdms.exe</span> and <span class="tt">$</span> is used to denote a command prompt which, in PowerShell, would look like <span class="tt">PS&gt;</span></p>
<details >
<summary >
Even more Windows troubleshooting</summary>
<p></p>
<p>We've seen that in a fresh PowerShell window, Windows does not remember the location of the <span class="tt">.dll</span> files, so you may have to re-add them to the path, or copy them into the directory where TDMS was installed.</p>
<p>TDMS typically installs to <span class="tt">"C:\Program Files (x86)\tdms\bin\tdms.exe"</span>.</p>
<p></p>
</details>
<p></p>
</details>
<hr  />
<p>You'll need to download and install <a href="https://www.mathworks.com/products/matlab.html">MATLAB</a>, and take note where the headers are installed.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Installation</h2>
<p>To compile and install, follow these steps:</p>
<div class="fragment"><div class="line">$ git clone git@github.com:UCL/TDMS.git</div>
<div class="line">$ cd TDMS</div>
<div class="line">$ git checkout v1.0.2 # the stable version</div>
<div class="line">$ mkdir build; cd build</div>
<div class="line">$ cmake ../tdms \</div>
<div class="line">$ # -DMatlab_ROOT_DIR=/usr/local/MATLAB/R20XXx/ \</div>
<div class="line">$ # -DFFTW_ROOT=/usr/local/fftw3/ \</div>
<div class="line">$ # -DCMAKE_INSTALL_PREFIX=$HOME/.local/</div>
<div class="line">$ cmake --build . --target install --config Release</div>
</div><!-- fragment --><p>If CMake cannot find MATLAB, FFTW, or install to the default installation prefix, uncomment the relevant line(s) and modify the path(s) accordingly.</p>
<p>You can check that <span class="tt">tdms</span> was installed correctly and is in your <span class="tt">PATH</span> by running:</p>
<div class="fragment"><div class="line">$ tdms --help</div>
<div class="line">$ tdms --version</div>
</div><!-- fragment --><p>in a new terminal.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
How to run</h2>
<p>You can run TDMS either directly or from a MATLAB script. For beginners, we recommend starting with the demonstration MATLAB script, which you can find in the <span class="tt">examples/arc_01</span> directory. Move into this directory, launch MATLAB, and run the MATLAB script <a href="https://github.com/UCL/TDMS/blob/main/examples/arc_01/run_pstd_bscan.m"><span class="tt">run_pstd_bscan.m</span></a>. This script will generate the input to TDMS, run TDMS, and display sample output. There are comments explaining what it is doing, so you can follow along with what is being setup and created at each stage. We have also commented the input file <a href="https://github.com/UCL/TDMS/blob/main/examples/arc_01/arc_01_example_input.m"><span class="tt">arc_01_example_input.m</span></a> that this script passes to <span class="tt">iteratefdtd_matrix.m</span>.</p>
<details >
<summary >
Troubleshooting</summary>
<p></p>
<p>We've seen that launching MATLAB on MacOS via the launcher (cmd + space) may not preserve the system <span class="tt">PATH</span>.</p>
<div class="fragment"><div class="line">command not found: tdms</div>
</div><!-- fragment --><p>Assuming <span class="tt">tdms --help</span> works in a new terminal, try launching MATLAB <em>from</em> that terminal.</p>
<div class="fragment"><div class="line">$ tdms --help</div>
<div class="line">$ /Applications/MATLAB_&lt;version&gt;.app/bin/matlab</div>
</div><!-- fragment --><p>The MATLAB example scripts should then find <span class="tt">tdms</span>. If you still have problems, you can try hard-coding the full path to <span class="tt">tdms</span> into the MATLAB script.</p>
<p>In a terminal run</p>
<div class="fragment"><div class="line">$ which tdms</div>
</div><!-- fragment --><p>Copy the full path (something like <span class="tt">/usr/local/bin/tdms</span>) into <a href="https://github.com/UCL/TDMS/blob/main/examples/arc_01/run_pstd_bscan.m"><span class="tt">run_pstd_bscan.m</span></a>, replacing the &lsquo;'tdms&rsquo;<span class="tt"> text in the calls to the </span>system()` function.</p>
<p></p>
</details>
<h3 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
MATLAB file version</h3>
<p>In order to be readable by TDMS, files need to be saved in .mat (MATLAB file) version 7.3 or newer. This can be done by passing '-v7.3' to MATLAB's save command as the final argument, for example:</p>
<div class="fragment"><div class="line">save(&#39;my_input_file.mat&#39;, &#39;my_input_var_1&#39;, &#39;my_input_var_2&#39;, ..., &#39;my_input_var_N&#39;, &#39;-v7.3&#39;);</div>
</div><!-- fragment --><details >
<summary >
Or set v7.3 as the default in MATLAB's settings.</summary>
<p></p>
<p><img src="doc/assets/matlab-file-settings.png" alt="" class="inline"/></p>
<p></p>
</details>
<h3 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
On the command line</h3>
<p>If you want to run TDMS standalone at the command line, the basic operation is with two arguments: an input file containing simulation parameters, and an output file name. You can choose between two solver methods: <b>finite-difference</b> or <b>pseudo-spectral</b>, as well as two interpolation methods: <b>cubic</b> or <b>bandlimited</b>. These options can be selected by setting the corresponding flag variables in the input file. When <span class="tt">tdms</span> reads the input, it will verify if the input file contains a dataset that matches the names of these flags.</p>
<p>There are two flags available for configuration in the input file.</p>
<details >
<summary >
<span class="tt">use_pstd</span> </summary>
<ul>
<li>If not provided, or provided as <span class="tt">false</span>, then the default timestepping method of finite-differences (FDTD) will be used.</li>
<li>If present and set to <span class="tt">true</span>, then <span class="tt">tdms</span> will use the pseudo-spectral (PSTD) method when performing simulation timesteps. </li>
</ul>
</details>
<details >
<summary >
<span class="tt">use_bli</span> </summary>
<ul>
<li>If not provided, or provided as <span class="tt">false</span>, then the default interpolation method of cubic interpolation will be used to obtain field values at the centres of Yee cells.</li>
<li>If present and set to <span class="tt">true</span>, then <span class="tt">tdms</span> will use bandlimited interpolation (BLI) when obtaining field values at Yee cell centres.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Typically bandlimited interpolation is superior to cubic interpolation when the extent of the Yee cell is of approximately the same order as, but slightly less than, one-sixth of the shortest wavelength of interest. Otherwise, cubic interpolation typically enjoys superior accuracy.</dd></dl>
</details>
<p>TDMS is parallelised with <a href="https://en.wikipedia.org/wiki/OpenMP">OpenMP</a>. You can set the maximum number of threads using the <span class="tt">OMP_NUM_THREADS</span> environment variable before calling the TDMS executable.</p>
<div class="fragment"><div class="line">$ export OMP_NUM_THREADS=4 # for example</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Citation</h2>
<p>If you used TDMS in your research and found it helpful, please cite this work: <a href="https://doi.org/10.5281/zenodo.7950604">10.5281/zenodo.7950604</a>.</p>
<details >
<summary >
BibTEX</summary>
<p></p>
<div class="fragment"><div class="line">@software{tdms,</div>
<div class="line">    author       = {Munro, Peter and others},</div>
<div class="line">    license      = {GPL-3.0},</div>
<div class="line">    title        = {{TDMS - The Time-Domain Maxwell Solver}},</div>
<div class="line">    URL          = {https://github.com/UCL/TDMS},</div>
<div class="line">    publisher    = {Zenodo},</div>
<div class="line">    doi          = {10.5281/zenodo.7950603}</div>
<div class="line">}</div>
</div><!-- fragment --><p></p>
</details>
<details >
<summary >
LaTeX</summary>
<p></p>
<div class="fragment"><div class="line">\bibitem{tdms}</div>
<div class="line">P. Munro, et al \emph{TDMS - The Time-Domain Maxwell Solver}, \url{https://github.com/UCL/TDMS}, \href{https://doi.org/10.5281/zenodo.7950603}{10.5281/zenodo.7950603}.</div>
</div><!-- fragment --><p></p>
</details>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Acknowledgements</h2>
<p>The TDMS source code was released under a GPL-3.0 License as part of a joint project between University College London's <a href="https://ucl.ac.uk/medphys">Medical Physics and Biomedical Engineering</a> and <a href="https://ucl.ac.uk/arc">Centre for Advanced Research Computing</a> with generous funding from the <a href="https://royalsociety.org">Royal Society</a>.</p>
<p><img src="doc/assets/biomedlogo.png" alt="medphys" class="inline"/>&#160;<img src="doc/assets/arclogo.png" alt="arc" class="inline"/></p>
<p>Development of this software has previously benefited from funding from the <a href="https://cscuk.fcdo.gov.uk/about-us/scholarships-and-fellowships/">Commonwealth Scholarships Commission</a>, the <a href="https://www.ukri.org/councils/epsrc/">Engineering and Physical Sciences Research Council</a>, and the <a href="https://www.arc.gov.au/">Australian Research Council</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Want to contribute?</h2>
<p>We're grateful for bug reports, feature requests, and pull requests. Please see our <a href="https://github-pages.ucl.ac.uk/TDMS/md__c_o_n_t_r_i_b_u_t_i_n_g.html">contribution guidelines</a> (we also have some <a href="https://github-pages.ucl.ac.uk/TDMS/md_doc_developers.html">developer documentation</a>). </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
